@using ReportViewerForMvc
@model OtherClasses.Models.MR_DATA.MR_DATAvm

@{

    ViewBag.Title = "Waiting_AttendanceListByClinic";
    ViewBag.TitleBar = "WAITING/ATTENDANCE LIST BY CLINIC";
    Layout = "~/Views/Shared/_MRFormLayout.cshtml";

    bool hasData = false; string b = "in active";
    if (Model.REPORTS != null) { hasData = true; }
}

<style>
    .borderLine {
        border-right: solid 2px black;
    }

    .title1 {
        font-size: 15px;
        font-weight: bold;
    }
</style>

<section>
    <!--Modal Start-->
    <div id="1LkUp" class="djq-modal djq-hide">
        <div class="djq-body">
            <div>
                <div class="djq-body1 deep-g alc">
                    <label class="label ls">LOOKUP FOR REGISTERED PATIENTS</label>
                </div>
                <div class="numberOfRows djq-hide"></div>

                <div class="djq-body11 alc">
                    <label class="label">Search: </label>
                    <input type="text" id="mySearchTerm" value="" class="input w-7" />
                    <button type="button" id="btnSearch" class="btn clm search-dataJQ">SEARCH</button>
                    <label id="djq-result" class="label"></label>
                    <label id="djq-aval" class="label hide">LOADING...</label>
                    <label id="djq-curVal" class="djq-hide"></label>
                    <label id="djq-max" class="djq-hide"></label>
                </div>
                <div class="loader djq-transp">.</div>

            </div>
            <div>
                <div class="djq-body2" style="margin-top: 0px !important;">
                    <table id="regPTable1">

                        <thead>
                        </thead>
                        <tbody></tbody>

                    </table>
                </div>
            </div>

            <div class="djq-body3 deep-g alc">
                <div class="inline-block ww50 all va-top">
                    <button type="button" id="first"
                            class="btn clm " style="background-color:#607d8b !important;">
                        &lt;&lt;&lt;
                    </button>
                    <button type="button" id="previous"
                            class="btn clm " style="background-color:#607d8b !important;">
                        &lt;&lt;
                    </button>
                    <button type="button" id="next"
                            class="btn clm " style="background-color:#607d8b !important;">
                        &gt;&gt;
                    </button>
                    <button type="button" id="last"
                            class="btn clm " style="background-color:#607d8b !important;">
                        &gt;&gt;&gt;
                    </button>
                </div>
                <div class="inline-block ww45 va-top">
                    <button type="button" class="btn clm select-dataJQ">SELECT</button>
                    <button type="button" class="btn clm close-dataJQ">CLOSE</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal End-->
    <!--Modal Start-->
    <div id="2LkUp" class="djq-modal djq-hide">

        <div class="djq-body">
            <div>
                <div class="djq-body1 deep-g alc">
                    <label class="label ls">LOOKUP FOR REGISTERED CORP. CLIENTS</label>
                </div>
                <div class="numberOfRows djq-hide"></div>

                <div class="djq-body11 alc">
                    <label class="label">Search: </label>
                    <input type="text" id="mySearchTerm" value="" class="input w-7" />
                    <button type="button" id="btnSearch" class="btn clm search-dataJQ">SEARCH</button>
                    <label id="djq-result" class="label"></label>
                    <label id="djq-aval" class="label hide">LOADING...</label>
                    <label id="djq-curVal" class="djq-hide"></label>
                    <label id="djq-max" class="djq-hide"></label>
                </div>
                <div class="loader djq-transp">.</div>

            </div>
            <div>
                <div class="djq-body2" style="margin-top: 0px !important;">
                    <table id="regPTable2">

                        <thead>
                        </thead>
                        <tbody></tbody>

                    </table>
                </div>
            </div>

            <div class="djq-body3 deep-g alc">
                <div class="inline-block ww50 all va-top">
                    <button type="button" id="first"
                            class="btn clm " style="background-color:#607d8b !important;">
                        &lt;&lt;&lt;
                    </button>
                    <button type="button" id="previous"
                            class="btn clm " style="background-color:#607d8b !important;">
                        &lt;&lt;
                    </button>
                    <button type="button" id="next"
                            class="btn clm " style="background-color:#607d8b !important;">
                        &gt;&gt;
                    </button>
                    <button type="button" id="last"
                            class="btn clm " style="background-color:#607d8b !important;">
                        &gt;&gt;&gt;
                    </button>
                </div>
                <div class="inline-block ww45 va-top">
                    <button type="button" class="btn clm select-dataJQ">SELECT</button>
                    <button type="button" class="btn clm close-dataJQ">CLOSE</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal End-->


    <form method="post" action="@Url.Action("AttendListByClinicSubmit", "File")">
        @Html.AntiForgeryToken()
        <input type="hidden" name="REPORTS.ActRslt" value="SalesSummaryReportByClient" />

        <div class="diff tab-content">

            <div id="TAB1" class="tab-pane fade  @if (!hasData) { @b}">


                <section>
                    <div class="py-4">
                        <div class="newline n1">
                            <label class="label w-10 w-35 drk">Enter Group Head or Customer Code...or...</label>
                            <input type="text" name="REPORTS.txtgrouphead" value="" class="input w-4 w-50 dData1 groupHead" />
                            <input type="button" name="btn" value="" id="refLookUp2" class="btn-small" />
                        </div>

                        <div class="newline n1">
                            <span>
                                <label class="label w-10 w-35 drk">Enter Patient's Group Code Hospital #..or</label>
                                <input type="text" name="REPORTS.txtgroupcode" value="" class="input w-4 w-50 cData2 groupCode" />
                                <input type="button" name="btn" value="" id="refLookUp1" class="btn-small" />
                            </span>

                            <span>
                                <label class="label w-1 w-35 drk"></label>
                                <input type="text" name="REPORTS.txtpatientno" value="" class="input w-4 w-50 cData1 patientNo" />
                                <input type="button" name="btn" value="" class="btn-small" />
                            </span>
                        </div>

                        <div class="newline n1">
                            <label class="label w-10 w-35 drk">Select Facility Code &lt;Null&gt; for ALL</label>
                            @Html.DropDownListFor(m => m.SYSCODETABSvm.ServiceCentreCodes.name,
                        new SelectList(Model.SYSCODETABSvm.ServiceCentreCodess, "type_code", "name"), "",
                        new { @id = "ivgFac", @class = "input w-5 increase-height facility" })
                        </div>

                        <div class="newline n1">
                            <label class="label w-10 w-35 drk"><i>Search String on Name In Attendance</i></label>
                            <input type="text" name="REPORTS.SearchName" value="" class="input w-10 w-50" />
                        </div>

                        <div class="newline n1">
                            <scan>
                                <label class="label w-10 w-35 drk">Transactions Date Range   -   From</label>
                                <input type="date" name="REPORTS.txtTimeFrom" value="@String.Format("{0:yyyy-MM-dd}", DateTime.Now)" class="input w-4 w-50 referralDate" />
                            </scan>
                            <span class="span">
                                <label class="label w-2 w-35 drk">TO :</label>
                                <input type="date" name="REPORTS.txtTimeTo" value="@String.Format("{0:yyyy-MM-dd}", DateTime.Now)" class="input w-4 w-50 referralDate" />
                            </span>
                        </div>
                        <div class="newline text-center">
                            <scan class="cred title1 nameLabel">...</scan>
                        </div>
                    </div>
                </section>


                <section class="dif">
                    <div class="row py-2">
                        <div class="col-md-4 borderLine">
                            <div class="">
                                <div class="newline n1 text-center">
                                    <label class="label w-3 drk cred">FILTER REPORT ON</label>
                                </div>

                                <div class="newline n1">
                                    <label class="label w-1 w-35"></label>
                                    <input type="radio" id="radio1" value="chkSpecialServicePatients" name="REPORTS.REPORT_TYPE1" />
                                    <label for="radio1" class="label drk">Special Service Patients Only</label>
                                </div>

                                <div class="newline n1">
                                    <label class="label w-1 w-35"></label>
                                    <input type="radio" id="radio2" value="chkNHISonly" name="REPORTS.REPORT_TYPE1" />
                                    <label for="radio2" class="label drk">NHIS Patients Only</label>
                                </div>

                                <div class="newline n1">
                                    <label class="label w-1 w-35"></label>
                                    <input type="radio" id="radio3" value="chkHMO" name="REPORTS.REPORT_TYPE1" />
                                    <label for="radio3" class="label drk">HMO Patients Only</label>
                                </div>

                                <div class="newline n1">
                                    <label class="label w-1 w-35"></label>
                                    <input type="radio" id="radio4" value="chkCorporates" name="REPORTS.REPORT_TYPE1" />
                                    <label for="radio4" class="label drk">Coperate Patients Only</label>
                                </div>

                                <div class="newline n1">
                                    <label class="label w-1 w-35"></label>
                                    <input type="radio" id="radio5" value="chkPVTFC" name="REPORTS.REPORT_TYPE1" />
                                    <label for="radio5" class="label drk">Private / Family Patients</label>
                                </div>

                                <div class="newline n1">
                                    <label class="label w-1 w-35"></label>
                                    <input type="radio" id="radio6" value="" name="REPORTS.REPORT_TYPE1" />
                                    <label for="radio6" class="label drk">All</label>
                                </div>

                            </div>

                        </div>

                        <div class="col-md-4 borderLine">
                            <div class="pt-4">
                                <div class="newline n1 ">
                                    <input type="checkbox" id="chkSRA" name="REPORTS.chkbyacctofficers" />
                                    <label for="chkSRA" class="label drk">Group by Clinic/Sevice Centre</label>
                                </div>

                                <div class="newline n1">
                                    <input type="checkbox" id="chkSRA1" name="REPORTS.chkSortByOperator" />
                                    <label for="chkSRA1" class="label drk">Waiting List Only</label>

                                </div>

                                <div class="newline n1">
                                    <input type="checkbox" id="chkSRA3" name="REPORTS.chkBroughtForward" />
                                    <label for="chkSRA3" class="label drk">Exceptions</label>
                                </div>

                                <div class="newline n1">
                                    <input type="checkbox" id="chkSRA4" name="REPORTS.chkStaffProfiling" />
                                    <label for="chkSRA4" class="label drk">Report Details With Patient Phone No./E-mail</label>
                                </div>

                                <div class="newline n1">
                                    <input type="checkbox" id="chkSRA5" name="REPORTS.chkDomantAccts" />
                                    <label for="chkSRA5" class="label drk">Visit Exceptions (Not Seen by Doctor)</label>
                                </div>

                                <div class="newline n1">
                                    <input type="checkbox" id="chkSRA6" name="REPORTS.chkLoyaltyCustomers" />
                                    <label for="chkSRA6" class="label drk cred">Monthly Comparative Summary</label>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="pt-4">
                                <div class="mb-3">
                                    <input type="checkbox" id="chkSRA2" name="REPORTS.chkByBranch" />
                                    <label for="chkSRA2" class="label drk">Sort by Consulting Docs</label>
                                </div>

                                <div>
                                    <label class="label w-3 w-35 drk">Doctor</label>
                                    @Html.DropDownListFor(v => v.DOCTORS.NAME,
                                new SelectList(@Model.DOCTORSS, "reference", "name"), "",
                                new { @class = "input w-5 w-50 increase-height Doc" })
                                </div>

                                <div class="mt-5">
                                    <label class="label w-3 w-35 drk">Hospital Acct</label>
                                    @Html.DropDownListFor(v => v.CUSTOMER.NAME,
                                new SelectList(Model.CUSTOMERS, "CUSTNO", "NAME"), "",
                                new { @id = "", @class = "input w-5 w-50 increase-height hospitalAcct" })
                                </div>
                            </div>
                        </div>
                    </div>
                </section>


                <section class="lme dif">
                    <div class="newline alc">
                        <input type="checkbox" id="chkSRA6" name="REPORTS.chkReportBankColumn" />
                        <label for="chkSRA6" class="label drk">Sort Report by Attendance Type</label>
                    </div>

                    <div class="row py-4">
                        <div class="col-md-3 alr">
                            <scan class="drk title1 cred">OPTIONS>>></scan>
                        </div>

                        <div class="col-md-3">
                            <div class="mb-3">
                                <input type="radio" id="radio7" value="chkMedicalTreatmt" name="REPORTS.REPORT_TYPE2" />
                                <label for="radio7" class="label drk">Medical Treatment</label>
                            </div>
                            <div class="mb-3">
                                <input type="radio" id="radio8" value="chkOnAppointmt" name="REPORTS.REPORT_TYPE2" />
                                <label for="radio8" class="label drk">On Appointment</label>
                            </div>
                            <div>
                                <input type="radio" id="radio9" value="" name="REPORTS.REPORT_TYPE2" />
                                <label for="radio9" class="label drk">On Docs-Patient Profile</label>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="mb-3">
                                <input type="radio" id="radio10" value="chkMedicalExam" name="REPORTS.REPORT_TYPE2" />
                                <label for="radio10" class="label drk">Medical Exams</label>
                            </div>
                            <div class="mb-3">
                                <input type="radio" id="radio11" value="chkSpecialistConsult" name="REPORTS.REPORT_TYPE2" />
                                <label for="radio11" class="label drk">Specialist Consult</label>
                            </div>
                            <div>
                                <input type="radio" id="radio12" value="chkDrugRefill" name="REPORTS.REPORT_TYPE2" />
                                <label for="radio12" class="label drk">Drug Refill/Collection</label>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="mb-3">
                                <input type="radio" id="radio13" value="chkDressingInj" name="REPORTS.REPORT_TYPE2" />
                                <label for="radio13" class="label drk">Dressing/Injection</label>
                            </div>
                            <div class="mb-3">
                                <input type="radio" id="radio14" value="chkOnFollowup" name="REPORTS.REPORT_TYPE2" />
                                <label for="radio14" class="label drk">On Follow-Up</label>
                            </div>
                            <div>
                                <input type="radio" id="radio15" value="chkALL" name="REPORTS.REPORT_TYPE2" />
                                <label for="radio15" class="label drk">A L L</label>
                            </div>
                        </div>
                    </div>

                    @*for checking when the print or preview buttons are clicked*@
                    <input type="hidden" value="false" name="REPORTS.cmbsave" class="printPreviewFlag" />
                </section>



            </div>

            <div id="TAB2" class="rpt tab-pane fade  @if (hasData) { @b} alc">
                @if (hasData)
            { @Html.ReportViewer(Model.REPORTS.GeneratedReport as Microsoft.Reporting.WebForms.ReportViewer, new { @class = "" }) }
            else
            {
                    <div style="min-height:50%;"><label class="lbl">Report Unavailable.</label></div>
                }
            </div>

        </div>

        <div class="newline n1 alc dif">
            <br />
            <input type="button" value="BACK" id="back1" class="btn" title="HINT: DOUBLE CLICK TO SHOW CLOSED REPORT" />
            <a data-toggle="tab" class="" id="back2" href="#TAB1"></a>
            <a data-toggle="tab" id="back3" class="" href="@if (hasData) { @("#TAB2") } else { @("#") } "></a>

            &nbsp;&nbsp;&nbsp;

            <input type="button" name="" value="PRINT" id="print1" class="btn" />
            <input type="hidden" id="pdfPath"
                   value="@if (hasData) { @(string.IsNullOrWhiteSpace(Model.REPORTS.PdfPath) ? "" : Model.REPORTS.PdfPath)} " />
            <input type="hidden" value="False" name="REPORTS.PRINT" id="print2" />

            &nbsp;&nbsp;&nbsp;

            <input type="button" name="" value="PREVIEW" id="pre1" class="btn" />
            <input type="submit" name="" value="" id="send" class="djq-hide" />

            <!--
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

            <a href="~/Home/Index" title="Close"><input type="button" name="btnClose" value="Close" class="btn" /></a>
            -->
            <br /><br />
        </div>

    </form>
</section>


@section scripts
{
    <script type="text/javascript">
        $(document).ready(function () {
            var dOM = $('body'); //must assign
            var formFields = document.getElementById('mainForm'); //must assign, used for calling javaScript methods
            appendTagInvalid1(dOM, "@ViewBag.iinvalid"); //must call
            servErrorAlert("#eLkUp", "@ViewBag.Msg"); //must call



            var dTHN1 = ['NAME', 'GROUPCODE', 'PATIENTNO', 'RESIDENCE', 'GROUPHEAD', 'SEX', 'PHONE']; //for table header
            var dBCN1 = ['NAME', 'GROUPCODE', 'PATIENTNO', 'RESIDENCE', 'GROUPHEAD', 'SEX', 'PHONE']; //for database header
            var jaxURL1 = "@Url.Action("RptBillChainLookUp", "AJAX")";

            var dTHN2 = ['NAME', 'REFERENCE', 'ADDRESS']; //for table header
            var dBCN2 = ['NAME', 'CUSTNO', 'ADDRESS1']; //for database header
            var jaxURL2 = "@Url.Action("RptCustomerLookUp", "AJAX")";

            //For Patient No.
            LoadDynamicDT1(jaxURL1, dTHN1, dBCN1, 'BILLCHAINS', '#refLookUp1', '#1LkUp', '#regPTable1', '.cData', [4, 3]);


            //For GroupHead
            LoadDynamicDT1(jaxURL2, dTHN2, dBCN2, 'CUSTOMERS', '#refLookUp2', '#2LkUp', '#regPTable2', '.dData', [3]);


            //On Load
            $(".hiddenSubmitBtn").hide();


            $(".patientNo").on({
                focusout: function () {
                    let patientNo = $(this).val();
                    let groupCode = $(".groupCode").val();

                    if (patientNo.trim() != "") {
                        $.ajax({
                            url: "/AJAX/AttendListPatientNoFocusout",
                            method: "POST",
                            data: { patientNo: patientNo, groupCode: groupCode },
                            success: function (data) {
                                if (data != null) {

                                    if (data.alertMessage != null) {
                                        alert(data.alertMessage);

                                        $(".patientNo").val("");
                                        $(".patientNo").focus();
                                    }

                                    if (data.TXTPATIENTNAME != null) {
                                        $(".nameLabel").text(data.TXTPATIENTNAME)
                                    }
                                }
                            }
                        })
                    }
                }
            })


            $(".groupHead").on({
                focusout: function () {
                    let groupHead = $(this).val();

                    if (groupHead.trim() != "") {
                        $.ajax({
                            url: "/AJAX/AttendListgroupHeadFocusout",
                            method: "POST",
                            data: { groupHead: groupHead },
                            success: function (data) {
                                if (data != null) {

                                    if (data.alertMessage != null) {
                                        alert(data.alertMessage);

                                        $(".groupHead").val("");
                                        $(".groupHead").focus();
                                    }

                                    if (data.TXTPATIENTNAME != null) {
                                        $(".nameLabel").text(data.TXTPATIENTNAME)
                                    }
                                }
                            }
                        })
                    }
                }
            })



            RptBtns(dOM, '@(hasData?(Model.REPORTS.PRINT?"True":""):"")');

            dOM.find('#pre1').on({
                click: function () {

				    if (!dOM.find('#TAB2').hasClass('active')) {
                        dOM.find('#send').click();
                    }

                }
            });

        });
    </script>
}






